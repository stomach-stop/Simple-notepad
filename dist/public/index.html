<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>メモ帳アプリ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    ul { padding-left: 0; }
    li { list-style: none; margin-bottom: 8px; }
    button { margin-left: 8px; }
    .edit-mode { background-color: #f0f0f0; padding: 5px; }
  </style>
</head>
<body>
  <h1>メモ帳</h1>

  <!-- 追加・編集フォーム -->
  <div>
    <input type="text" id="title" placeholder="タイトル" />
    <input type="text" id="content" placeholder="本文" />
    <button id="add-button">追加</button>
    <button id="update-button" style="display:none">更新</button>
    <button id="cancel-button" style="display:none">キャンセル</button>
  </div>

  <h2>メモ一覧</h2>
  <ul id="memo-list"></ul>

  <script>
    const memoList = document.getElementById("memo-list");
    const titleInput = document.getElementById("title");
    const contentInput = document.getElementById("content");
    const addButton = document.getElementById("add-button");
    const updateButton = document.getElementById("update-button");
    const cancelButton = document.getElementById("cancel-button");

    let editingId = null; // 現在編集中のメモID

    // メモ一覧を取得して表示
    async function loadMemos() {
      const res = await fetch("/memos");
      const memos = await res.json();

      memoList.innerHTML = "";

      memos.forEach(memo => {
        const li = document.createElement("li");
        li.textContent = `${memo.title}：${memo.content}`;

        // ---------- 編集ボタン ----------
        const editButton = document.createElement("button");
        editButton.textContent = "編集";
        editButton.addEventListener("click", () => {
          titleInput.value = memo.title;
          contentInput.value = memo.content;
          editingId = memo.id;

          addButton.style.display = "none";
          updateButton.style.display = "inline";
          cancelButton.style.display = "inline";
        });

        // ---------- 削除ボタン ----------
        const delButton = document.createElement("button");
        delButton.textContent = "削除";
        delButton.addEventListener("click", async () => {
          const res = await fetch(`/memos/${memo.id}`, { method: "DELETE" });
          if (!res.ok) { alert("削除に失敗しました"); return; }
          loadMemos();
        });

        li.appendChild(editButton);
        li.appendChild(delButton);
        memoList.appendChild(li);
      });
    }

    // ---------- 追加処理 ----------
    addButton.addEventListener("click", async () => {
      const title = titleInput.value.trim();
      const content = contentInput.value.trim();
      if (!title || !content) { alert("タイトルと本文を入力してください"); return; }

      const res = await fetch("/memos", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, content })
      });
      if (!res.ok) { alert("メモの追加に失敗しました"); return; }

      titleInput.value = "";
      contentInput.value = "";
      loadMemos();
    });

    // ---------- 更新処理 ----------
    updateButton.addEventListener("click", async () => {
      if (!editingId) return;
      const title = titleInput.value.trim();
      const content = contentInput.value.trim();
      if (!title && !content) { alert("タイトルか本文を入力してください"); return; }

      const res = await fetch(`/memos/${editingId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, content })
      });
      if (!res.ok) { alert("更新に失敗しました"); return; }

      titleInput.value = "";
      contentInput.value = "";
      editingId = null;

      addButton.style.display = "inline";
      updateButton.style.display = "none";
      cancelButton.style.display = "none";

      loadMemos();
    });

    // ---------- 編集キャンセル ----------
    cancelButton.addEventListener("click", () => {
      titleInput.value = "";
      contentInput.value = "";
      editingId = null;

      addButton.style.display = "inline";
      updateButton.style.display = "none";
      cancelButton.style.display = "none";
    });

    // 初回ロード
    loadMemos();
  </script>
</body>
</html>
